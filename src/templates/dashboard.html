<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Bot Dashboard</title>
    
    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/css/main.css" rel="stylesheet">
    
    <style>
        /* Custom Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            bottom: 0;
            left: -250px; /* يبدأ مخفياً */
            width: 250px;
            padding: 1rem;
            background-color: #1a1a1a;
            z-index: 100;
            transition: left 0.3s ease; /* إضافة انتقال سلس */
        }

        .sidebar:hover {
            left: 0;
        }

        .main-content {
            margin-left: 0; /* بدلاً من 250px */
            padding: 2rem;
            transition: margin-left 0.3s ease;
        }

        .main-content.shifted {
            margin-left: 250px;
        }
        
        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: #ffffff;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .sidebar-link:hover {
            background-color: #2c2c2c;
            color: #fff;
        }
        
        .sidebar-link.active {
            background-color: #0d6efd;
            color: #fff;
        }
        
        .sidebar-icon {
            margin-right: 0.75rem;
            font-size: 1.1rem;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        /* Logo Area */
        .logo-area {
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid #2c2c2c;
            margin-bottom: 1rem;
        }
        
        .logo-area img {
            height: 60px;
            margin-bottom: 0.5rem;
        }
        
        .version-tag {
            font-size: 0.8rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Logo Area -->
        <div class="logo-area">
            <img src="/static/img/tvwb-logo.png" alt="Trading Bot">
            <div class="version-tag">Version {{ version }}</div>
        </div>
        
        <!-- Navigation Links -->
        <nav class="nav flex-column">
            <a href="#dashboard" class="sidebar-link active" onclick="showSection('dashboard')">
                <i class="bi bi-speedometer2 sidebar-icon"></i>
                Dashboard
            </a>
            <a href="#api-settings" class="sidebar-link" onclick="showSection('api-settings')">
                <i class="bi bi-key sidebar-icon"></i>
                API Settings
            </a>
            <a href="#bot-manager" class="sidebar-link" onclick="showSection('bot-manager')">
                <i class="bi bi-robot sidebar-icon"></i>
                Bot Manager
            </a>
            <a href="#ip-manager" class="sidebar-link" onclick="showSection('ip-manager')">
                <i class="bi bi-shield-lock sidebar-icon"></i>
                IP Manager
            </a>
            <a href="#events" class="sidebar-link" onclick="showSection('events')">
                <i class="bi bi-lightning sidebar-icon"></i>
                Events
            </a>
            <a href="#actions" class="sidebar-link" onclick="showSection('actions')">
                <i class="bi bi-gear sidebar-icon"></i>
                Actions
            </a>
            <a href="#logs" class="sidebar-link" onclick="showSection('logs')">
                <i class="bi bi-journal-text sidebar-icon"></i>
                System Logs
            </a>
        </nav>
        
        <!-- Bottom Status -->
        <div class="mt-auto" style="position: absolute; bottom: 1rem; left: 1rem; right: 1rem;">
            <div class="d-flex justify-content-between align-items-center p-2 bg-dark rounded">
                <span class="badge bg-success" id="connectionStatus">Connected</span>
                <span class="text-light small" id="balanceStatus">$0.00</span>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Alert Area -->
        <div id="alertArea" style="position: fixed; top: 1rem; right: 1rem; z-index: 1050;"></div>
        
        <!-- Content Sections will be added in Part 2 -->
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Deactivate all nav links
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Activate selected nav link
            document.querySelector(`[href="#${sectionId}"]`).classList.add('active');
        }

        function showAlert(type, message) {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert" style="max-width: 500px">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            const alertArea = document.getElementById('alertArea');
            alertArea.insertAdjacentHTML('beforeend', alertHtml);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                const alerts = alertArea.getElementsByClassName('alert');
                if (alerts.length > 0) {
                    alerts[0].remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>
<!-- Main Dashboard Section -->
<section id="dashboard" class="content-section active">
    <h2 class="mb-4">Dashboard Overview</h2>
    
    <!-- Account Summary Cards -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white h-100">
                <div class="card-body">
                    <h6 class="card-title">Total Balance</h6>
                    <h3 class="mb-0" id="totalBalance">$0.00</h3>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card bg-success text-white h-100">
                <div class="card-body">
                    <h6 class="card-title">Available Balance</h6>
                    <h3 class="mb-0" id="availableBalance">$0.00</h3>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card bg-info text-white h-100">
                <div class="card-body">
                    <h6 class="card-title">Open Positions</h6>
                    <h3 class="mb-0" id="openPositions">0</h3>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card bg-warning text-dark h-100">
                <div class="card-body">
                    <h6 class="card-title">24h PnL</h6>
                    <h3 class="mb-0" id="dailyPnL">$0.00</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Positions Table -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">Active Positions</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Side</th>
                            <th>Size</th>
                            <th>Entry Price</th>
                            <th>Mark Price</th>
                            <th>PnL</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="positionsTableBody">
                        <!-- Will be populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>

<!-- API Settings Section -->
<section id="api-settings" class="content-section">
    <h2 class="mb-4">API Configuration</h2>
    
    <!-- API Keys Form -->
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Binance API Settings</h5>
                </div>
                <div class="card-body">
                    <form id="apiSettingsForm">
                        <div class="mb-3">
                            <label class="form-label">API Key</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="apiKey" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('apiKey')">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">API Secret</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="apiSecret" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('apiSecret')">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="testnetMode">
                                <label class="form-check-label">Enable Testnet Mode</label>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-2"></i>Save Settings
                        </button>
                        
                        <button type="button" class="btn btn-secondary ms-2" onclick="testConnection()">
                            <i class="bi bi-arrow-repeat me-2"></i>Test Connection
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <!-- API Permissions Check -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">API Permissions Check</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group" id="permissionsList">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Read Info
                            <span class="badge bg-secondary" id="readPermission">Unchecked</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Spot Trading
                            <span class="badge bg-secondary" id="spotPermission">Unchecked</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Futures Trading
                            <span class="badge bg-secondary" id="futuresPermission">Unchecked</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Connection Status -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Connection Status</h5>
                </div>
                <div class="card-body">
                    <div id="connectionDetails">
                        <p class="mb-2">
                            <strong>Status:</strong>
                            <span id="apiStatus" class="badge bg-secondary">Not Connected</span>
                        </p>
                        <p class="mb-2">
                            <strong>Last Check:</strong>
                            <span id="lastCheck">Never</span>
                        </p>
                        <p class="mb-0">
                            <strong>Environment:</strong>
                            <span id="environment">-</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Additional JavaScript for API Settings -->
<script>
function togglePassword(elementId) {
    const input = document.getElementById(elementId);
    input.type = input.type === 'password' ? 'text' : 'password';
}

function testConnection() {
    const apiKey = document.getElementById('apiKey').value;
    const apiSecret = document.getElementById('apiSecret').value;
    const testnet = document.getElementById('testnetMode').checked;

    if (!apiKey || !apiSecret) {
        showAlert('danger', 'Please enter both API Key and Secret');
        return;
    }

    // Update UI to show testing state
    document.getElementById('apiStatus').className = 'badge bg-warning';
    document.getElementById('apiStatus').textContent = 'Testing...';

    // Send test request
    $.ajax({
        url: '/api/binance/test-connection',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
            apiKey: apiKey,
            apiSecret: apiSecret,
            testnet: testnet
        }),
        success: function(response) {
            updateConnectionStatus(response);
            showAlert('success', 'Connection test successful!');
        },
        error: function(xhr) {
            document.getElementById('apiStatus').className = 'badge bg-danger';
            document.getElementById('apiStatus').textContent = 'Failed';
            showAlert('danger', `Connection test failed: ${xhr.responseText}`);
        }
    });
}

function updateConnectionStatus(data) {
    // Update status badge
    const apiStatus = document.getElementById('apiStatus');
    apiStatus.className = 'badge bg-success';
    apiStatus.textContent = 'Connected';

    // Update last check time
    document.getElementById('lastCheck').textContent = new Date().toLocaleString();

    // Update environment
    document.getElementById('environment').textContent = 
        data.testnet ? 'Testnet' : 'Mainnet';

    // Update permissions
    updatePermissionBadge('readPermission', data.permissions.canRead);
    updatePermissionBadge('spotPermission', data.permissions.canSpot);
    updatePermissionBadge('futuresPermission', data.permissions.canFutures);
}

function updatePermissionBadge(elementId, hasPermission) {
    const badge = document.getElementById(elementId);
    if (hasPermission) {
        badge.className = 'badge bg-success';
        badge.textContent = 'Enabled';
    } else {
        badge.className = 'badge bg-danger';
        badge.textContent = 'Disabled';
    }
}

// Form submission handler
$('#apiSettingsForm').on('submit', function(e) {
    e.preventDefault();
    
    const apiKey = document.getElementById('apiKey').value;
    const apiSecret = document.getElementById('apiSecret').value;
    const testnet = document.getElementById('testnetMode').checked;

    $.ajax({
        url: '/api/settings/api',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
            apiKey: apiKey,
            apiSecret: apiSecret,
            testnet: testnet
        }),
        success: function(response) {
            showAlert('success', 'API settings saved successfully!');
            testConnection(); // Test connection after saving
        },
        error: function(xhr) {
            showAlert('danger', `Error saving API settings: ${xhr.responseText}`);
        }
    });
});
</script>
<!-- Bot Manager Section -->
<section id="bot-manager" class="content-section">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Bot Manager</h2>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newBotModal">
            <i class="bi bi-plus-circle me-2"></i>Create New Bot
        </button>
    </div>
    
    <!-- Bots Grid -->
    <div class="row g-4" id="botsContainer">
        <!-- Sample Bot Card -->
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">BTC Strategy</h5>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" checked>
                    </div>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted">Symbol:</small>
                        <div class="fw-bold">BTCUSDT</div>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted">Strategy:</small>
                        <div class="fw-bold">RSI + MA Crossover</div>
                    </div>
                    <div class="row g-2">
                        <div class="col-6">
                            <small class="text-muted">Position Size:</small>
                            <div class="fw-bold">0.01 BTC</div>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Leverage:</small>
                            <div class="fw-bold">10x</div>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="btn-group w-100">
                        <button class="btn btn-outline-primary">Edit</button>
                        <button class="btn btn-outline-danger">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- IP Manager Section -->
<section id="ip-manager" class="content-section">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>IP Management</h2>
        <button class="btn btn-primary" onclick="detectCurrentIP()">
            <i class="bi bi-plus-circle me-2"></i>Add Current IP
        </button>
    </div>

    <div class="row">
        <!-- IP Management Card -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Allowed IP Addresses</h5>
                </div>
                <div class="card-body">
                    <!-- Add IP Form -->
                    <form id="ipForm" class="mb-4">
                        <div class="input-group">
                            <input type="text" class="form-control" id="newIpAddress" 
                                   placeholder="Enter IP address (e.g., 192.168.1.1)">
                            <button class="btn btn-primary" type="submit">Add IP</button>
                        </div>
                    </form>

                    <!-- IP List Table -->
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>IP Address</th>
                                    <th>Added Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ipListTable">
                                <!-- Will be populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- IP Information Card -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">IP Information</h5>
                </div>
                <div class="card-body">
                    <div id="currentIpInfo">
                        <p class="mb-2">
                            <strong>Your Current IP:</strong>
                            <span id="currentIp">Loading...</span>
                        </p>
                        <p class="mb-2">
                            <strong>Status:</strong>
                            <span id="ipStatus" class="badge bg-secondary">Checking...</span>
                        </p>
                        <hr>
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            Make sure to add your IP address to use API functions.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- New Bot Modal -->
<div class="modal fade" id="newBotModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Trading Bot</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="newBotForm">
                    <!-- Basic Settings -->
                    <div class="mb-4">
                        <h6 class="fw-bold">Basic Settings</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Bot Name</label>
                                <input type="text" class="form-control" name="botName" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Trading Pair</label>
                                <input type="text" class="form-control" name="symbol" 
                                       placeholder="e.g., BTCUSDT" required>
                            </div>
                        </div>
                    </div>

                    <!-- Position Settings -->
                    <div class="mb-4">
                        <h6 class="fw-bold">Position Settings</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Position Size (USDT)</label>
                                <input type="number" class="form-control" name="positionSize" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Leverage</label>
                                <select class="form-select" name="leverage" required>
                                    <option value="1">1x</option>
                                    <option value="3">3x</option>
                                    <option value="5">5x</option>
                                    <option value="10">10x</option>
                                    <option value="20">20x</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Management -->
                    <div class="mb-4">
                        <h6 class="fw-bold">Risk Management</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Stop Loss (%)</label>
                                <input type="number" class="form-control" name="stopLoss" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Take Profit (%)</label>
                                <input type="number" class="form-control" name="takeProfit" required>
                            </div>
                        </div>
                    </div>

                    <!-- Strategy Settings -->
                    <div class="mb-4">
                        <h6 class="fw-bold">Strategy Settings</h6>
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Trading Strategy</label>
                                <select class="form-select" name="strategy" required>
                                    <option value="rsi_ma">RSI + Moving Average</option>
                                    <option value="bb">Bollinger Bands</option>
                                    <option value="macd">MACD</option>
                                    <option value="custom">Custom Strategy</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="createBot()">Create Bot</button>
            </div>
        </div>
    </div>
</div>

<!-- IP Management JavaScript -->
<script>
async function detectCurrentIP() {
    try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        document.getElementById('currentIp').textContent = data.ip;
        document.getElementById('newIpAddress').value = data.ip;
        checkIpStatus(data.ip);
    } catch (error) {
        showAlert('danger', 'Error detecting IP address');
    }
}

function checkIpStatus(ip) {
    const statusBadge = document.getElementById('ipStatus');
    
    $.get('/api/security/ip', function(allowedIps) {
        if (allowedIps.includes(ip)) {
            statusBadge.className = 'badge bg-success';
            statusBadge.textContent = 'Allowed';
        } else {
            statusBadge.className = 'badge bg-warning';
            statusBadge.textContent = 'Not Allowed';
        }
    });
}

function loadIpList() {
    $.get('/api/security/ip', function(ips) {
        const tbody = $('#ipListTable');
        tbody.empty();
        
        ips.forEach(ip => {
            tbody.append(`
                <tr>
                    <td>${ip}</td>
                    <td>${new Date().toLocaleDateString()}</td>
                    <td><span class="badge bg-success">Active</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="removeIp('${ip}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>
            `);
        });
    });
}

$('#ipForm').on('submit', function(e) {
    e.preventDefault();
    
    const ip = $('#newIpAddress').val().trim();
    if (!ip) {
        showAlert('danger', 'Please enter an IP address');
        return;
    }
    
    $.ajax({
        url: '/api/security/ip',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ ip: ip }),
        success: function(response) {
            showAlert('success', 'IP address added successfully');
            $('#newIpAddress').val('');
            loadIpList();
            checkIpStatus(ip);
        },
        error: function(xhr) {
            showAlert('danger', 'Error adding IP address');
        }
    });
});

// Bot Management JavaScript
function createBot() {
    const formData = new FormData(document.getElementById('newBotForm'));
    const botData = Object.fromEntries(formData.entries());
    
    $.ajax({
        url: '/api/bots',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(botData),
        success: function(response) {
            showAlert('success', 'Bot created successfully');
            $('#newBotModal').modal('hide');
            loadBots();
        },
        error: function(xhr) {
            showAlert('danger', 'Error creating bot: ' + xhr.responseText);
        }
    });
}

// Initialize
$(document).ready(function() {
    detectCurrentIP();
    loadIpList();
});
</script>
<!-- Events Section -->
<section id="events" class="content-section">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Events Manager</h2>
        <button class="btn btn-primary" onclick="createNewEvent()">
            <i class="bi bi-plus-circle me-2"></i>Create New Event
        </button>
    </div>

    <div class="row">
        <!-- Events List -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Registered Events</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Event Name</th>
                                    <th>Webhook Key</th>
                                    <th>Linked Actions</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="eventsTable">
                                {% for event in event_list %}
                                <tr>
                                    <td>{{ event.name }}</td>
                                    <td>
                                        <div class="input-group">
                                            <input type="text" class="form-control form-control-sm" 
                                                   value="{{ event.key }}" readonly>
                                            <button class="btn btn-sm btn-outline-secondary" 
                                                    onclick="copyToClipboard('{{ event.key }}')">
                                                <i class="bi bi-clipboard"></i>
                                            </button>
                                        </div>
                                    </td>
                                    <td>
                                        {% for action in event._actions %}
                                        <span class="badge bg-info">{{ action }}</span>
                                        {% endfor %}
                                    </td>
                                    <td>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" 
                                                   {% if event.active %}checked{% endif %}
                                                   onchange="toggleEvent('{{ event.name }}', this.checked)">
                                        </div>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-primary" onclick="editEvent('{{ event.name }}')">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteEvent('{{ event.name }}')">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Test -->
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Quick Test</h5>
                </div>
                <div class="card-body">
                    <form id="testWebhookForm">
                        <div class="mb-3">
                            <label class="form-label">Select Event</label>
                            <select class="form-select" id="testEventSelect" required>
                                <option value="">Choose event...</option>
                                {% for event in event_list %}
                                <option value="{{ event.key }}">{{ event.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Test Data (JSON)</label>
                            <textarea class="form-control" id="testData" rows="5" required>
{
    "symbol": "BTCUSDT",
    "side": "buy",
    "amount": 0.001
}</textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-play-circle me-2"></i>Test Webhook
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Actions Section -->
<section id="actions" class="content-section">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Actions Manager</h2>
        <div>
            <button class="btn btn-secondary me-2" onclick="importAction()">
                <i class="bi bi-download me-2"></i>Import Action
            </button>
            <button class="btn btn-primary" onclick="createNewAction()">
                <i class="bi bi-plus-circle me-2"></i>Create New Action
            </button>
        </div>
    </div>

    <!-- Actions Grid -->
    <div class="row g-4">
        {% for action in action_list %}
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">{{ action.name }}</h5>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" checked>
                    </div>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted">Linked Events:</small>
                        <div>
                            {% for event in event_list if action in event._actions %}
                            <span class="badge bg-info">{{ event.name }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted">Description:</small>
                        <div>{{ action.__doc__ or "No description available" }}</div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="btn-group w-100">
                        <button class="btn btn-outline-primary" onclick="editAction('{{ action.name }}')">
                            <i class="bi bi-pencil me-1"></i>Edit
                        </button>
                        <button class="btn btn-outline-secondary" onclick="viewLogs('{{ action.name }}')">
                            <i class="bi bi-journal-text me-1"></i>Logs
                        </button>
                        <button class="btn btn-outline-danger" onclick="deleteAction('{{ action.name }}')">
                            <i class="bi bi-trash me-1"></i>Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>

<!-- Logs Section -->
<section id="logs" class="content-section">
    <h2 class="mb-4">System Logs</h2>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Log Level</label>
                    <select class="form-select" id="logLevelFilter">
                        <option value="">All Levels</option>
                        <option value="INFO">Info</option>
                        <option value="WARNING">Warning</option>
                        <option value="ERROR">Error</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Component</label>
                    <select class="form-select" id="componentFilter">
                        <option value="">All Components</option>
                        <option value="Event">Events</option>
                        <option value="Action">Actions</option>
                        <option value="Bot">Bots</option>
                        <option value="System">System</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Date Range</label>
                    <div class="input-group">
                        <input type="date" class="form-control" id="startDate">
                        <input type="date" class="form-control" id="endDate">
                    </div>
                </div>
                <div class="col-md-2">
                    <label class="form-label">&nbsp;</label>
                    <button class="btn btn-primary w-100" onclick="applyLogFilters()">
                        Apply Filters
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Log Viewer -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Log Entries</h5>
            <div>
                <button class="btn btn-sm btn-secondary me-2" onclick="exportLogs()">
                    <i class="bi bi-download me-1"></i>Export
                </button>
                <button class="btn btn-sm btn-danger" onclick="clearLogs()">
                    <i class="bi bi-trash me-1"></i>Clear
                </button>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Level</th>
                            <th>Component</th>
                            <th>Message</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody id="logsTable">
                        <!-- Will be populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-footer">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    Showing <span id="logCount">0</span> entries
                </div>
                <div class="btn-group">
                    <button class="btn btn-sm btn-outline-secondary" onclick="loadMoreLogs()">
                        Load More
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" onclick="refreshLogs()">
                        <i class="bi bi-arrow-clockwise"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Additional JavaScript -->
<script>
// Event Management
function createNewEvent() {
    // Implementation
}

function toggleEvent(eventName, active) {
    $.ajax({
        url: '/event/active',
        method: 'POST',
        data: { event: eventName, active: active },
        success: function(response) {
            showAlert('success', `Event ${eventName} ${active ? 'activated' : 'deactivated'}`);
        },
        error: function(xhr) {
            showAlert('danger', 'Error updating event status');
        }
    });
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        showAlert('success', 'Copied to clipboard!');
    });
}

// Action Management
function createNewAction() {
    // Implementation
}

function viewLogs(actionName) {
    $('#logLevelFilter').val('');
    $('#componentFilter').val('Action');
    applyLogFilters();
}

// Logs Management
let lastLogId = null;

function loadLogs() {
    const filters = {
        level: $('#logLevelFilter').val(),
        component: $('#componentFilter').val(),
        startDate: $('#startDate').val(),
        endDate: $('#endDate').val(),
        lastId: lastLogId
    };

    $.get('/logs', filters, function(logs) {
        if (logs.length > 0) {
            lastLogId = logs[logs.length - 1].id;
            displayLogs(logs);
        }
    });
}

function displayLogs(logs) {
    const tbody = $('#logsTable');
    logs.forEach(log => {
        const row = `
            <tr>
                <td>${new Date(log.event_time).toLocaleString()}</td>
                <td>
                    <span class="badge bg-${getLogLevelColor(log.event_type)}">
                        ${log.event_type}
                    </span>
                </td>
                <td>${log.parent}</td>
                <td>${log.event_data}</td>
                <td>
                    <button class="btn btn-sm btn-link" onclick='showLogDetails(${JSON.stringify(log)})'>
                        <i class="bi bi-info-circle"></i>
                    </button>
                </td>
            </tr>
        `;
        tbody.append(row);
    });
    
    $('#logCount').text($('#logsTable tr').length);
}

function getLogLevelColor(level) {
    const colors = {
        'INFO': 'info',
        'WARNING': 'warning',
        'ERROR': 'danger',
        'SUCCESS': 'success'
    };
    return colors[level] || 'secondary';
}

function showLogDetails(log) {
    // Implementation
}

function applyLogFilters() {
    $('#logsTable').empty();
    lastLogId = null;
    loadLogs();
}

function exportLogs() {
    const filters = {
        level: $('#logLevelFilter').val(),
        component: $('#componentFilter').val(),
        startDate: $('#startDate').val(),
        endDate: $('#endDate').val(),
        format: 'csv'
    };
    
    window.location.href = `/logs/export?${new URLSearchParams(filters)}`;
}

// Auto-refresh logs and update dashboard
// Auto-refresh logs and update dashboard
setInterval(() => {
    if ($('#logs').hasClass('active')) {
        loadLogs();
    }
}, 5000);

// إضافة هذا الكود لمعالجة تحريك المحتوى
document.querySelector('.sidebar').addEventListener('mouseenter', function() {
    document.querySelector('.main-content').classList.add('shifted');
});

document.querySelector('.sidebar').addEventListener('mouseleave', function() {
    document.querySelector('.main-content').classList.remove('shifted');
});

</script>
</body>
</html>